Yencon (ヱンコン環境設定ファイル)
=================================
Copyright (C) 2019 Takym.

## 概要
Yenconは「Yencon Environment Configuration」の略(再帰的頭字語)で日本語名は「ヱンコン」です。
「ヱンコン環境設定ファイル」や「Yencon environment configuration file」と表記しても構いません。
初期化ファイルに似た簡単な構文を持ち、バイナリファイルとしても保存する事ができます。
OSDeveloperで利用する為に開発されました。

## 例
以下はテキスト形式での例です。
```Yencon
; ヱンコン環境設定ファイルの大まかなな仕様
; Comment Out
; 識別子(キー名)は英数字とアンダースコアのみ
; 文字列はダブルクオーテーションで囲む
Name="String Value"
; 階層構造は{}で表現する
Root={
    ItemOfRoot="abcdef"
    SubKey={
        ; キー名の先頭にも数字を使える
        0=#05
        1=#16
        2=#27
        3=#38
        4=#49
    }
}
; 数字は#から始める
Number=#123
; ブール値はTとFで表現
Positive=T
Negative=F
; 改行やクオーテーション等はエスケープする
EscapedText="\qHello, World!!\q\r\n\tBye! See \'you\' next time. \\\\"
; 空のセクション
EmptySection={}
; NULL値
NullValue=_
```

## フォーマット
 * Yenconは、大きく分けてテキスト形式とバイナリ形式とリソース形式の三つフォーマットがあります。
	* **テキスト形式** はユーザーによって書き換えられてもいい設定ファイル等に利用します。
	* **バイナリ形式** はファイル容量が少量になり、ユーザーによって書き換えられてはいけない設定ファイルに利用します。
	* **リソース形式** は **テキスト形式** または **バイナリ形式** のどちらかが拡張子からは判別できない種類のファイルを表します。
 * 全ての値はキーと呼び、キーには空値、コメント、セクション、文字列、数値、論理値等の種類があります。
	* キー名は半角英数字(0-9, A-Z, a-z)と下線(_)を利用する事ができ、先頭に数字を入れる事もできます。

## テキスト形式
テキスト形式ではキーは「名前=値」の様に記述します。
等号(=)は必ず半角文字にしてください。
```Yencon
Name="String Value"
```
キーは1行に1つだけ定義する事ができます。
2つのキーを同じ行に書く事はできません。
また、値の先頭の文字を型指定子と呼びます。
複数行で書く事ができる値には、最後には型終了子と呼ばれる、値が終わった事を表す文字が存在します。
文字コードは「UTF-16」が推奨されます。
OSDeveloperでは「UTF-16」以外のテキスト形式は読み込めません。

## バイナリ形式
バイナリ形式ではファイルの先頭にヘッダー情報が保存されています。
ヘッダー情報には以下の様な情報が保存されています。
|名前          |オフセット (16進数)|サイズ (バイト単位)|説明                                                                   |
|:-------------|------------------:|------------------:|:----------------------------------------------------------------------|
|署名          |                +00|                4 B|ファイルの識別用です。値は常に「62 59 43 4E」です。                    |
|キー名モード  |                +04|                1 B|キーの名前に関するフラグを保持しています。詳しくは後述します。         |
|バージョン情報|                +05|                3 B|ファイルを書き込んだパーサーの種類を表します。現在は「00 00 00」です。 |
|予約済み      |                +08|                4 B|現在はまだ利用されていません。常に「0xFFh」で埋めて置く事を推奨します。|
|キーの数      |                +0C|                4 B|ルートセクション内のキーの数です。全体のキーの数ではありません。       |
|              |                   |                   |この値は符号無し32ビットです。                                         |
キー名モードは、以下の様な情報(フラグ)が保存されています。
|左からのビット数|内容                                                                                                     |
|---------------:|:--------------------------------------------------------------------------------------------------------|
|             1-2|キーの名前の大きさを表す数字の大きさです。                                                               |
|                |「00」の場合は8ビット、「01」の場合は16ビット、「10」の場合は32ビット、「11」の場合は64ビットになります。|
|                |ただし、現在は64ビットは利用していません。                                                               |
|               3|キーの名前の文字コートの種類を表します。                                                                 |
|                |「0」の場合は「UTF-16」、「1」の場合は「ASCII」になります。                                              |
|             4-8|未使用です。
ヘッダー情報の後ろには、ヘッダーで指定された「キーの数」だけキーが存在しています。
キーは以下の様に保存されています。
|名前        |オフセット (16進数)|サイズ (バイト単位)|説明                                                            |
|:-----------|------------------:|------------------:|:---------------------------------------------------------------|
|名前の大きさ|                +00|                ? B|キー名の長さです。この値のサイズはキー名モードに依存しています。|
|名前        |                +??|                ? B|キーの名前です。文字コードはキー名モードに依存しています。      |
|型識別子    |                +??|                1 B|キーの種類です。                                                |
|値          |                +??|                ? B|キーの値です。型によって書き方が違います。                      |

## 同名のキー
同じセクションの中の同名のキーは、後に定義したキーの値が優先されます。

## 型一覧
Yenconのキーの種類を説明します。

### 空値
 * バイナリ形式での型識別子: 「0x00h」
 * テキスト形式での型指定子: 「_」
 * テキスト形式での型終了子: 無し
 * 値がNULLまたは空である事を表します。

### コメント
 * バイナリ形式での型識別子: 「0xFFh」
 * テキスト形式での型指定子: 「;」
 * テキスト形式での型終了子: 改行
 * プログラムで参照されない値を表します。
 * キー名は省略する事ができます。
 * キー名が省略された場合、システム上では一時的なGUIDが割り当てられます。
 * バイナリ形式では以下の様に表します。これは文字列と同じ様な形式です。
|名前    |オフセット (16進数)|サイズ (バイト単位)|説明                                              |
|:-------|------------------:|------------------:|:-------------------------------------------------|
|大きさ  |                +00|                4 B|コメントの長さです。符号無し32ビットで指定します。|
|コメント|                +??|                ? B|コメントです。UTF-16で記述します。                |

### セクション
 * バイナリ形式での型識別子: 「0x01h」
 * テキスト形式での型指定子: 「{」
 * テキスト形式での型終了子: 「}」
 * キーの集まりを表します。
 * テキスト形式では波括弧の中にそのままキーを書きます。
 * バイナリ形式ではキーの数を符号無し32ビットで記述し、キーの数だけ子キーを書きます。

### 文字列
 * バイナリ形式での型識別子: 「0x02h」
 * テキスト形式での型指定子: 「"」
 * テキスト形式での型終了子: 「"」
 * 文字列を表します。
 * テキスト形式では以下の形式でエスケープされています。
|エスケープ文字|実際の文字|
|:------------:|:--------:|
|\'            |'         |
|\\            |\         |
|\q            |"         |
|\s            |(半角空白)|
|\S            |(全角空白)|
|\t            |(タブ)    |
|\n            |(改行, LF)|
|\r            |(改行, CR)|
 * バイナリ形式では以下の様に表します。
|名前  |オフセット (16進数)|サイズ (バイト単位)|説明                                            |
|:-----|------------------:|------------------:|:-----------------------------------------------|
|大きさ|                +00|                4 B|文字列の長さです。符号無し32ビットで指定します。|
|文字列|                +??|                ? B|文字列です。UTF-16で記述します。                |

### 数値
 * バイナリ形式での型識別子: 「0x03h」
 * テキスト形式での型指定子: 「#」
 * テキスト形式での型終了子: 無し
 * 符号無し64ビット整数値を表します。

### 論理値
 * 論理値は解析器の最適化の為、「真」と「偽」で型が変わります。
#### 真
 * バイナリ形式での型識別子: 「0x04h」
 * テキスト形式での型指定子: 「T」
 * テキスト形式での型終了子: 無し
 * 「真」の値を表します。
#### 偽
 * バイナリ形式での型識別子: 「0x05h」
 * テキスト形式での型指定子: 「F」
 * テキスト形式での型終了子: 無し
 * 「偽」の値を表します。

## 拡張子
 * テキスト形式の場合、拡張子は「.tycn」または「.ycn」になります。
 * バイナリ形式の場合、拡張子は「.bycn」または「.ycn」になります。
 * リソース形式の場合、拡張子は「.rycn」または「.ycn」になります。
 * OSDeveloperでは、テキスト形式に「.inix」、バイナリ形式に「.cfg」を利用しています。

## 今後追加予定の機能
これは追加予定の機能です。追加されない場合もあります。
 * オブジェクトの直列化機能
	* クラスをシリアル化/逆シリアル化する事で、読み込み/書き込み処理が短く書ける。
 * スキーマ機能
	* 自動的にヱンコンファイルの内容を検証できるようになる。
 * キー名モードに数字モードを追加する。
	* これにより、バイナリ形式で数字のキー名が少量になる。
 * 文字列値やコメントの文字列長を保持する値の大きさを変えれる様にする。
	* 「キー名モード」の「大きさ」の様な機能。
 * 文字列値やコメントの文字コードの種類を増やす。
	* これにより、バイナリ形式で文字列の表現の幅が増える。
 * テキスト形式でキー名を「==」「:=」「=:」「::」「:」でも区切れる様にする。
 * 数値の種類を追加する。
	* 0～255までの数値は少量で表現できる様になる。
	* 浮動小数点数値を表現できる様になり、文字列で小数を表現する必要が無くなる。
 * エラー情報に行番号を追加する。
 * 列挙文字列を追加して、文字列が有効か無効か確認できる様にする。
	* バイナリ形式では数値だけで保存できる様になる。
 * 日時専用の型
	* バイナリ形式では6バイトで保存できる様になり、長い文字列を保存する必要が無くなる。
